<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DP4SS - 20&nbsp; Efficient Use of Group Structure</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./6_10-intro-to-data-viz.html" rel="next">
<link href="./5_10-constructing-groups.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="www/textbook.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./4_10-data-verbs.html">Data Wrangling</a></li><li class="breadcrumb-item"><a href="./5_20-group-structure.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Efficient Use of Group Structure</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">DP4SS</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction:</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">The Data Science Toolkit</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0_10-core-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The <strong>R</strong> Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0_20-rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R Studio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0_30-data-driven-docs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data-Driven Docs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0_31-markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Markdown Guide</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_00-learning-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Learning to Program</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_10-getting-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Getting Help</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">The Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_10-calculator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R: An Overdesigned Calculator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_20-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_30-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Assignment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_10-data-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Vectors and Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_20-data-exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exploring Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_21-summary-stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Descriptive Statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Data IO</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_40-importing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Getting Data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_50-saving-objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Saving Data to File</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_10-data-verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Data Verbs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_20-data-recipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Data Recipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_30-data-joins-core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Data Joins</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_40-data-joins-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Joins With dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_10-constructing-groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Constructing Groups</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_20-group-structure.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Efficient Use of Group Structure</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./6_10-intro-to-data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Data Viz</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_20-plot-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">The plot() Function</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_30-customized-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Customizing Plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_31-xkcd-stickfigures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Stylized Plot Example</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_40-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">The Grammar of Graphics</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#packages-used-in-this-chapter" id="toc-packages-used-in-this-chapter" class="nav-link active" data-scroll-target="#packages-used-in-this-chapter"><span class="header-section-number">20.1</span> Packages Used in this Chapter</a></li>
  <li><a href="#hypothetical-experimental-data" id="toc-hypothetical-experimental-data" class="nav-link" data-scroll-target="#hypothetical-experimental-data"><span class="header-section-number">20.2</span> Hypothetical Experimental Data</a></li>
  <li><a href="#group-structure" id="toc-group-structure" class="nav-link" data-scroll-target="#group-structure"><span class="header-section-number">20.3</span> Group Structure</a>
  <ul class="collapse">
  <li><a href="#what-are-groups" id="toc-what-are-groups" class="nav-link" data-scroll-target="#what-are-groups"><span class="header-section-number">20.3.1</span> What Are Groups?</a></li>
  <li><a href="#main-take-away" id="toc-main-take-away" class="nav-link" data-scroll-target="#main-take-away"><span class="header-section-number">20.3.2</span> Main Take-Away</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">20.3.3</span> Example</a></li>
  </ul></li>
  <li><a href="#analysis-by-group" id="toc-analysis-by-group" class="nav-link" data-scroll-target="#analysis-by-group"><span class="header-section-number">20.4</span> Analysis by Group</a>
  <ul class="collapse">
  <li><a href="#highest-average-player-salary" id="toc-highest-average-player-salary" class="nav-link" data-scroll-target="#highest-average-player-salary"><span class="header-section-number">20.4.1</span> Highest Average Player Salary</a></li>
  <li><a href="#most-players-paid-over-5-million" id="toc-most-players-paid-over-5-million" class="nav-link" data-scroll-target="#most-players-paid-over-5-million"><span class="header-section-number">20.4.2</span> Most Players Paid Over $5 Million</a></li>
  <li><a href="#fielding-positions" id="toc-fielding-positions" class="nav-link" data-scroll-target="#fielding-positions"><span class="header-section-number">20.4.3</span> Fielding Positions</a></li>
  <li><a href="#country-of-birth" id="toc-country-of-birth" class="nav-link" data-scroll-target="#country-of-birth"><span class="header-section-number">20.4.4</span> Country of Birth</a></li>
  <li><a href="#pay-raises" id="toc-pay-raises" class="nav-link" data-scroll-target="#pay-raises"><span class="header-section-number">20.4.5</span> Pay Raises</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./4_10-data-verbs.html">Data Wrangling</a></li><li class="breadcrumb-item"><a href="./5_20-group-structure.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Efficient Use of Group Structure</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Efficient Use of Group Structure</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="packages-used-in-this-chapter" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="packages-used-in-this-chapter"><span class="header-section-number">20.1</span> Packages Used in this Chapter</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( pander )</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( dplyr )</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( tidyr )</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( reshape2 )</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( scales )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( ggplot2 )</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( Lahman )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hypothetical-experimental-data" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="hypothetical-experimental-data"><span class="header-section-number">20.2</span> Hypothetical Experimental Data</h2>
<p>We will demonstrate some functions using this hypothetical dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( d ) <span class="sc">%&gt;%</span> pander</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">race</th>
<th style="text-align: center;">blood.type</th>
<th style="text-align: center;">gender</th>
<th style="text-align: center;">age</th>
<th style="text-align: center;">study.group</th>
<th style="text-align: center;">speed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">white</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">37</td>
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">470.9</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">black</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">52</td>
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">540</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">white</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">49</td>
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">615.2</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">black</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">570.2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">asian</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">635.1</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">white</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">55</td>
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">588.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="group-structure" class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="group-structure"><span class="header-section-number">20.3</span> Group Structure</h2>
<p>The two most important skills as you first learn a data programming language are:</p>
<ol type="1">
<li>Translating English phrases into computer code using logical statements<br>
</li>
<li>Organizing your data into groups</li>
</ol>
<p>This lecture focuses on efficiently splitting your data into groups, and then analyzing your data by group.</p>
<section id="what-are-groups" class="level3" data-number="20.3.1">
<h3 data-number="20.3.1" class="anchored" data-anchor-id="what-are-groups"><span class="header-section-number">20.3.1</span> What Are Groups?</h3>
<p>A group represents a set of elements with identical characteristics - mice all belong to one group and elephants belong to another. Easy enough, right?</p>
<p>In data analysis, it is a little more complicated because a group is defined by a set of features. Each group still represents a set of elements with identical characteristics, but when we have multiple features there is a unique group for each combination of features.</p>
<p>The simple way to think about this is that the cross-tab of features generates a grid (table), and each cell represents a unique group:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p>We might be interested in simple groups (treatment cases versus control cases) or complex groups (does the treatment effect women and men differently?).</p>
<p>In previous lectures you have learned to identify a group with a logical statement and analyze that group discretely.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>( speed[ study.group <span class="sc">==</span> <span class="st">"treatment"</span> <span class="sc">&amp;</span> gender<span class="sc">==</span><span class="st">"female"</span> ] )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 611.6984</code></pre>
</div>
</div>
<p>In this lecture you will learn to define a group structure, then analyze all of your data using that structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>( speed, <span class="at">INDEX =</span> <span class="fu">list</span>( study.group, gender ), <span class="at">FUN =</span> mean )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">female</th>
<th style="text-align: center;">male</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>control</strong></td>
<td style="text-align: center;">460.2</td>
<td style="text-align: center;">350.9</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>treatment</strong></td>
<td style="text-align: center;">611.7</td>
<td style="text-align: center;">518.8</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="main-take-away" class="level3" data-number="20.3.2">
<h3 data-number="20.3.2" class="anchored" data-anchor-id="main-take-away"><span class="header-section-number">20.3.2</span> Main Take-Away</h3>
<p>R has been designed to do efficient data analysis by defining a group structure, then quickly applying a function to all unique members.</p>
<p><img src="figures/group_plus_function.png" width="300"></p>
<p>The base R packages do this with a set of functions in the <strong>apply()</strong> family. The <strong>tapply()</strong> function allows you to specify an outcome to analyze and a group, then ask for results from a function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>( <span class="at">X=</span>speed, <span class="at">INDEX=</span><span class="fu">list</span>( study.group, gender ), <span class="at">FUN=</span>mean ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">female</th>
<th style="text-align: center;">male</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>control</strong></td>
<td style="text-align: center;">460.2</td>
<td style="text-align: center;">350.9</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>treatment</strong></td>
<td style="text-align: center;">611.7</td>
<td style="text-align: center;">518.8</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The <strong>dplyr</strong> package makes this process easier using some simple verbs and the “pipe” operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dat  <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>( study.group, gender )  <span class="sc">%&gt;%</span>  <span class="fu">summarize</span>( <span class="at">ave.speed =</span> <span class="fu">mean</span>(speed) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">study.group</th>
<th style="text-align: center;">gender</th>
<th style="text-align: center;">ave.speed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">control</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">350.9</td>
</tr>
<tr class="even">
<td style="text-align: center;">control</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">460.2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">518.8</td>
</tr>
<tr class="even">
<td style="text-align: center;">treatment</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">611.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="example" class="level3" data-number="20.3.3">
<h3 data-number="20.3.3" class="anchored" data-anchor-id="example"><span class="header-section-number">20.3.3</span> Example</h3>
<p>Let’s think about a study looking at reading speed. The treatment is a workshop that teaches some speed-reading techniques. In this study we have data on:</p>
<ul>
<li>gender (male, female)</li>
<li>race (black, white, asian)</li>
<li>blood.type (A, B)</li>
<li>age (from 18 to 93)</li>
</ul>
<p>Examining descriptive statistics we can see that reading speed varies by gender and the treatment group, but not by race or blood type:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The question is, how many unique groups can we create with these four factors?</p>
<p>Each individual factor contains a small number of levels (only 2 or 3 in this case), which makes the group structure look deceptively simple at first glance. When we start to examine combinations of factors we see that group structure can get complicated pretty quickly.</p>
<p>If we look at gender alone, we have two levels: male and female. So we have two groups. If we look at our study groups alone we have two groups: treatment and control.</p>
<p>If we look at gender and the study groups together, we now have a 2 x 2 grid, or four unique groups.</p>
<p>If the race factor has three levels, how many unique groups will we have considering the study design, gender, and race together?</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>We can calculate the size of the grid by multiplying number of levels for each factor. We see here we have 12 unique groups:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nlevels</span>( gender ) <span class="sc">*</span> <span class="fu">nlevels</span>( study.group ) <span class="sc">*</span> <span class="fu">nlevels</span>( race )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
</div>
<p>If we add blood type, a factor with two levels (A and B), we now have 24 unique groups:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">facet_grid</span>( race <span class="sc">+</span> study.group <span class="sc">~</span> gender <span class="sc">+</span> blood.type) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>What about age? It is a continuous variable, so it’s a little more tricky.</p>
<p>We can certainly analyze the relationship between age and speed using correlation tools.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( age, speed, <span class="at">bty=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Age"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>But we can also incorporate this independent variable into a group structure. We can treat each distinct age as a separate group. The ages in this study range from 18 to 93, so we have 65 distinct ages represented.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="fu">factor</span>(age), speed, <span class="at">las=</span><span class="dv">2</span>, <span class="at">frame.plot=</span>F, <span class="at">outline=</span>F, <span class="at">main=</span><span class="st">"Age"</span>, <span class="at">xaxt=</span><span class="st">"n"</span>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>If we think about the overall group structure, then, we have unique groups defined by gender, race, blood type, and study design, and another 65 age groups. So in total we now have 24 x 65 = 1,560 groups! That is getting complicated.</p>
<p>This group design is problematic for two reasons. From a pragmatic standpoint, we can’t report results from 1,500 groups in a table. From a more substantive perspective, although we have 1,500 distinct cells in our grid, many may not include observations that represent the unique combination of all factors. So this group design is not very practical.</p>
<p>A similar problem arises if our data includes time. If our data includes the time of events recorded by hours, days of the week, months, and years, we can have complicated group structures if we try to analyze every unique combination.</p>
<p>We can simplify our analysis by thinking about age ranges instead of ages, or in other words by binning our continuous data. If we split it into five-year ranges, for example, we have gone from 65 distinct ages to 12 distinct age groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>age.group <span class="ot">&lt;-</span> <span class="fu">cut</span>( age, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">20</span>,<span class="at">to=</span><span class="dv">80</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">paste</span>( <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">20</span>,<span class="at">to=</span><span class="dv">75</span>,<span class="at">by=</span><span class="dv">5</span>), </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"to"</span>, <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">25</span>,<span class="at">to=</span><span class="dv">80</span>,<span class="at">by=</span><span class="dv">5</span>) ) )</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>group.structure <span class="ot">&lt;-</span> <span class="fu">formula</span>( speed <span class="sc">~</span> age.group )</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>( group.structure, <span class="at">las=</span><span class="dv">2</span>, <span class="at">frame.plot=</span>F, <span class="at">outline=</span>F, <span class="at">main=</span><span class="st">"Age Group"</span>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>We have now simplified our analysis from 1,560 to 288 possible groups. Combinations of groups will also be easier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>group.structure <span class="ot">&lt;-</span> <span class="fu">formula</span>( speed <span class="sc">~</span> gender <span class="sc">*</span> age.group )</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>( group.structure, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">las=</span><span class="dv">2</span>, <span class="at">frame.plot=</span>F, <span class="at">outline=</span>F, <span class="at">main=</span><span class="st">"Age Group by Gender"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="fu">c</span>(<span class="st">"firebrick"</span>,<span class="st">"steelblue"</span>), <span class="at">xaxt=</span><span class="st">"n"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="analysis-by-group" class="level2" data-number="20.4">
<h2 data-number="20.4" class="anchored" data-anchor-id="analysis-by-group"><span class="header-section-number">20.4</span> Analysis by Group</h2>
<p>Let’s demonstrate some analysis of groups using the Lahman package and some <strong>dplyr</strong> verbs. Let’s do some analysis of player salaries (<em>Salaries</em> dataset), and start with a simple group structure - teams in the National League and time.</p>
<ol type="1">
<li>Which team has the highest average player salary?</li>
<li>Which team has the most players paid over $5 million a season?</li>
<li>Which team has raised it’s pay the most over the past decade?</li>
</ol>
<p>Let’s start by thinking about group structure. We have teams, and we have seasons. Teams is stored as a factor, and seasons as a numeric value, so we can consider group for each by counting levels and unique values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nlevels</span>( Salaries<span class="sc">$</span>teamID )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>( <span class="fu">unique</span>( Salaries<span class="sc">$</span>yearID ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32</code></pre>
</div>
</div>
<p>So we can potentially calculate 32 x 46 = 1,472 average player salaries.</p>
<section id="highest-average-player-salary" class="level3" data-number="20.4.1">
<h3 data-number="20.4.1" class="anchored" data-anchor-id="highest-average-player-salary"><span class="header-section-number">20.4.1</span> Highest Average Player Salary</h3>
<p>For our first question, we will select only teams from the National League. Let’s use the most recent year of data to calculate average pay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( lgID <span class="sc">==</span> <span class="st">"NL"</span>, yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">Ave_Salary =</span> <span class="fu">mean</span>(salary) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 2
   teamID Ave_Salary
   &lt;fct&gt;       &lt;dbl&gt;
 1 ARI      3363041.
 2 ATL      2362010.
 3 CHN      5312678.
 4 CIN      3066899.
 5 COL      3413487 
 6 LAN      6322525.
 7 MIA      2761222.
 8 MIL      2292508.
 9 NYN      4958857.
10 PHI      2033793.
11 PIT      3706387.
12 SDN      3756475.
13 SFN      6890151.
14 SLN      4614629.
15 WAS      5448179.</code></pre>
</div>
</div>
<p>Since the salaries are large, they are a little hard to read. Let’s clean up the table a bit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Salaries  <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>( lgID <span class="sc">==</span> <span class="st">"NL"</span>, yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">Ave_Salary=</span><span class="fu">dollar</span>( <span class="fu">mean</span>(salary,<span class="at">na.rm=</span>T) ) ) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">arrange</span>( <span class="fu">desc</span>(Ave_Salary) ) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">teamID</th>
<th style="text-align: center;">Ave_Salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">SFN</td>
<td style="text-align: center;">$6,890,151</td>
</tr>
<tr class="even">
<td style="text-align: center;">LAN</td>
<td style="text-align: center;">$6,322,525</td>
</tr>
<tr class="odd">
<td style="text-align: center;">WAS</td>
<td style="text-align: center;">$5,448,179</td>
</tr>
<tr class="even">
<td style="text-align: center;">CHN</td>
<td style="text-align: center;">$5,312,678</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NYN</td>
<td style="text-align: center;">$4,958,857</td>
</tr>
<tr class="even">
<td style="text-align: center;">SLN</td>
<td style="text-align: center;">$4,614,629</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SDN</td>
<td style="text-align: center;">$3,756,475</td>
</tr>
<tr class="even">
<td style="text-align: center;">PIT</td>
<td style="text-align: center;">$3,706,387</td>
</tr>
<tr class="odd">
<td style="text-align: center;">COL</td>
<td style="text-align: center;">$3,413,487</td>
</tr>
<tr class="even">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">$3,363,041</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CIN</td>
<td style="text-align: center;">$3,066,899</td>
</tr>
<tr class="even">
<td style="text-align: center;">MIA</td>
<td style="text-align: center;">$2,761,222</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">$2,362,010</td>
</tr>
<tr class="even">
<td style="text-align: center;">MIL</td>
<td style="text-align: center;">$2,292,508</td>
</tr>
<tr class="odd">
<td style="text-align: center;">PHI</td>
<td style="text-align: center;">$2,033,793</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="most-players-paid-over-5-million" class="level3" data-number="20.4.2">
<h3 data-number="20.4.2" class="anchored" data-anchor-id="most-players-paid-over-5-million"><span class="header-section-number">20.4.2</span> Most Players Paid Over $5 Million</h3>
<p>This question requires you to utilize a logical statement in order to translate from the question to code. We need to inspect each salary, determine whether it is over the $5m threshold, then count all of the cases. The operation will look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>( Salaries<span class="sc">$</span>salary <span class="sc">&gt;</span> <span class="dv">5000000</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3175</code></pre>
</div>
</div>
<p>It gets a little trickier when we want to do the operation simultaneously across groups. Our team group structure is already defined, so let’s define our logical vector and count cases that match:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat.NL <span class="ot">&lt;-</span> <span class="fu">filter</span>( Salaries, yearID <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">"NL"</span> ) <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>gt<span class="fl">.5</span>m <span class="ot">&lt;-</span> dat.NL<span class="sc">$</span>salary <span class="sc">&gt;</span> <span class="dv">5000000</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>( dat.NL<span class="sc">$</span>teamID, gt<span class="fl">.5</span>m )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     gt.5m
      FALSE TRUE
  ARI    23    3
  ATL    21    6
  CHN    19    8
  CIN    21    5
  COL    23    6
  FLO    23    4
  HOU    24    4
  LAN    20    7
  MIL    25    4
  NYN    19    9
  PHI    18   10
  PIT    27    0
  SDN    25    1
  SFN    21    7
  SLN    19    6
  WAS    26    4</code></pre>
</div>
</div>
<p>This solution works, but the table provides too much information. We can use <strong>dplyr</strong> to simplify and format the table nicely for our report:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>( yearID <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">"NL"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>( teamID ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>( <span class="at">gt_five_million =</span> <span class="fu">sum</span>( salary <span class="sc">&gt;</span> <span class="dv">5000000</span> ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>( <span class="fu">desc</span>(gt_five_million) ) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>   pander</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">teamID</th>
<th style="text-align: center;">gt_five_million</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">PHI</td>
<td style="text-align: center;">10</td>
</tr>
<tr class="even">
<td style="text-align: center;">NYN</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CHN</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td style="text-align: center;">LAN</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SFN</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="even">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">COL</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td style="text-align: center;">SLN</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CIN</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">FLO</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">HOU</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">MIL</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">WAS</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SDN</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">PIT</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="fielding-positions" class="level3" data-number="20.4.3">
<h3 data-number="20.4.3" class="anchored" data-anchor-id="fielding-positions"><span class="header-section-number">20.4.3</span> Fielding Positions</h3>
<p>Which fielding position is the highest paid?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>( Salaries, Fielding ) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( POS ) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">Mean_Salary =</span> <span class="fu">dollar</span>( <span class="fu">mean</span>(salary) ) ) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  pander</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">POS</th>
<th style="text-align: center;">Mean_Salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1B</td>
<td style="text-align: center;">$5,680,014</td>
</tr>
<tr class="even">
<td style="text-align: center;">2B</td>
<td style="text-align: center;">$3,092,188</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3B</td>
<td style="text-align: center;">$3,812,355</td>
</tr>
<tr class="even">
<td style="text-align: center;">C</td>
<td style="text-align: center;">$3,167,962</td>
</tr>
<tr class="odd">
<td style="text-align: center;">OF</td>
<td style="text-align: center;">$4,317,165</td>
</tr>
<tr class="even">
<td style="text-align: center;">P</td>
<td style="text-align: center;">$4,002,667</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SS</td>
<td style="text-align: center;">$2,574,626</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="country-of-birth" class="level3" data-number="20.4.4">
<h3 data-number="20.4.4" class="anchored" data-anchor-id="country-of-birth"><span class="header-section-number">20.4.4</span> Country of Birth</h3>
<p>Which country has produced the highest paid baseball players?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>( Salaries, People ) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( yearID <span class="sc">==</span> <span class="dv">2016</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( birthCountry ) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">Mean_Salary =</span> <span class="fu">dollar</span>( <span class="fu">mean</span>(salary) ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  pander</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">birthCountry</th>
<th style="text-align: center;">Mean_Salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Aruba</td>
<td style="text-align: center;">$650,000</td>
</tr>
<tr class="even">
<td style="text-align: center;">Australia</td>
<td style="text-align: center;">$523,400</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">$1,548,792</td>
</tr>
<tr class="even">
<td style="text-align: center;">CAN</td>
<td style="text-align: center;">$7,854,167</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Colombia</td>
<td style="text-align: center;">$3,125,289</td>
</tr>
<tr class="even">
<td style="text-align: center;">Cuba</td>
<td style="text-align: center;">$5,787,593</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Curacao</td>
<td style="text-align: center;">$5,724,167</td>
</tr>
<tr class="even">
<td style="text-align: center;">D.R.</td>
<td style="text-align: center;">$5,045,623</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Germany</td>
<td style="text-align: center;">$511,500</td>
</tr>
<tr class="even">
<td style="text-align: center;">Japan</td>
<td style="text-align: center;">$8,247,012</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Mexico</td>
<td style="text-align: center;">$5,333,671</td>
</tr>
<tr class="even">
<td style="text-align: center;">Netherlands</td>
<td style="text-align: center;">$2,425,000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Nicaragua</td>
<td style="text-align: center;">$2,375,000</td>
</tr>
<tr class="even">
<td style="text-align: center;">P.R.</td>
<td style="text-align: center;">$3,241,378</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Panama</td>
<td style="text-align: center;">$2,946,550</td>
</tr>
<tr class="even">
<td style="text-align: center;">Saudi Arabia</td>
<td style="text-align: center;">$522,500</td>
</tr>
<tr class="odd">
<td style="text-align: center;">South Korea</td>
<td style="text-align: center;">$5,326,190</td>
</tr>
<tr class="even">
<td style="text-align: center;">Taiwan</td>
<td style="text-align: center;">$6,750,000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">USA</td>
<td style="text-align: center;">$4,222,249</td>
</tr>
<tr class="even">
<td style="text-align: center;">V.I.</td>
<td style="text-align: center;">$507,500</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Venezuela</td>
<td style="text-align: center;">$4,521,051</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="pay-raises" class="level3" data-number="20.4.5">
<h3 data-number="20.4.5" class="anchored" data-anchor-id="pay-raises"><span class="header-section-number">20.4.5</span> Pay Raises</h3>
<p>To examine pay raises, we will now use more than one year of data. Since the question asks about pay raises over the past decade, we will filter the last ten years of data.</p>
<p>And since we are looking at patterns over teams and over time, we need to define a group structure with two variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2006</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">"NL"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">mean=</span> <span class="fu">dollar</span>(<span class="fu">mean</span>(salary)) ) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">head</span>( <span class="dv">20</span> ) <span class="sc">%&gt;%</span> pander</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">teamID</th>
<th style="text-align: center;">yearID</th>
<th style="text-align: center;">mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2007</td>
<td style="text-align: center;">$1,859,555</td>
</tr>
<tr class="even">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2008</td>
<td style="text-align: center;">$2,364,383</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2009</td>
<td style="text-align: center;">$2,812,141</td>
</tr>
<tr class="even">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2010</td>
<td style="text-align: center;">$2,335,314</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2011</td>
<td style="text-align: center;">$1,986,660</td>
</tr>
<tr class="even">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2012</td>
<td style="text-align: center;">$2,733,512</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2013</td>
<td style="text-align: center;">$3,004,400</td>
</tr>
<tr class="even">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2014</td>
<td style="text-align: center;">$3,763,904</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2015</td>
<td style="text-align: center;">$2,132,207</td>
</tr>
<tr class="even">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">2016</td>
<td style="text-align: center;">$3,363,041</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2007</td>
<td style="text-align: center;">$3,117,530</td>
</tr>
<tr class="even">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2008</td>
<td style="text-align: center;">$3,412,189</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2009</td>
<td style="text-align: center;">$3,335,385</td>
</tr>
<tr class="even">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2010</td>
<td style="text-align: center;">$3,126,802</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2011</td>
<td style="text-align: center;">$3,346,257</td>
</tr>
<tr class="even">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2012</td>
<td style="text-align: center;">$2,856,205</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2013</td>
<td style="text-align: center;">$3,254,501</td>
</tr>
<tr class="even">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2014</td>
<td style="text-align: center;">$4,067,042</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2015</td>
<td style="text-align: center;">$2,990,885</td>
</tr>
<tr class="even">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">2016</td>
<td style="text-align: center;">$2,362,010</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This might seem like an odd format. We might expect something that looks more like our grid structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dat.NL <span class="ot">&lt;-</span> <span class="fu">filter</span>( Salaries, yearID <span class="sc">&gt;</span> <span class="dv">2010</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">"NL"</span> ) <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>( dat.NL<span class="sc">$</span>salary, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">INDEX=</span><span class="fu">list</span>(dat.NL<span class="sc">$</span>teamID, dat.NL<span class="sc">$</span>yearID), </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN=</span>mean, <span class="at">na.rm=</span>T ) <span class="sc">%&gt;%</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">2011</th>
<th style="text-align: center;">2012</th>
<th style="text-align: center;">2013</th>
<th style="text-align: center;">2014</th>
<th style="text-align: center;">2015</th>
<th style="text-align: center;">2016</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>ARI</strong></td>
<td style="text-align: center;">1986660</td>
<td style="text-align: center;">2733512</td>
<td style="text-align: center;">3004400</td>
<td style="text-align: center;">3763904</td>
<td style="text-align: center;">2132207</td>
<td style="text-align: center;">3363041</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>ATL</strong></td>
<td style="text-align: center;">3346257</td>
<td style="text-align: center;">2856205</td>
<td style="text-align: center;">3254501</td>
<td style="text-align: center;">4067042</td>
<td style="text-align: center;">2990885</td>
<td style="text-align: center;">2362010</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>CHN</strong></td>
<td style="text-align: center;">5001893</td>
<td style="text-align: center;">3392194</td>
<td style="text-align: center;">3867989</td>
<td style="text-align: center;">2426759</td>
<td style="text-align: center;">4138547</td>
<td style="text-align: center;">5312678</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>CIN</strong></td>
<td style="text-align: center;">2531571</td>
<td style="text-align: center;">2935843</td>
<td style="text-align: center;">4256178</td>
<td style="text-align: center;">3864911</td>
<td style="text-align: center;">4187862</td>
<td style="text-align: center;">3066899</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>COL</strong></td>
<td style="text-align: center;">3390310</td>
<td style="text-align: center;">2692054</td>
<td style="text-align: center;">2976363</td>
<td style="text-align: center;">3180117</td>
<td style="text-align: center;">3827544</td>
<td style="text-align: center;">3413487</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>FLO</strong></td>
<td style="text-align: center;">2190154</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>HOU</strong></td>
<td style="text-align: center;">2437724</td>
<td style="text-align: center;">2332731</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>LAN</strong></td>
<td style="text-align: center;">3472967</td>
<td style="text-align: center;">3171453</td>
<td style="text-align: center;">6980069</td>
<td style="text-align: center;">6781706</td>
<td style="text-align: center;">7441103</td>
<td style="text-align: center;">6322525</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>MIA</strong></td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">4373259</td>
<td style="text-align: center;">1400079</td>
<td style="text-align: center;">1549515</td>
<td style="text-align: center;">2835688</td>
<td style="text-align: center;">2761222</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>MIL</strong></td>
<td style="text-align: center;">2849911</td>
<td style="text-align: center;">3755921</td>
<td style="text-align: center;">3077881</td>
<td style="text-align: center;">3748778</td>
<td style="text-align: center;">3477586</td>
<td style="text-align: center;">2292508</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>NYN</strong></td>
<td style="text-align: center;">4401752</td>
<td style="text-align: center;">3457555</td>
<td style="text-align: center;">1648278</td>
<td style="text-align: center;">3168777</td>
<td style="text-align: center;">3870667</td>
<td style="text-align: center;">4958857</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>PHI</strong></td>
<td style="text-align: center;">5765879</td>
<td style="text-align: center;">5817965</td>
<td style="text-align: center;">6533200</td>
<td style="text-align: center;">5654530</td>
<td style="text-align: center;">4295885</td>
<td style="text-align: center;">2033793</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>PIT</strong></td>
<td style="text-align: center;">1553345</td>
<td style="text-align: center;">2248286</td>
<td style="text-align: center;">2752214</td>
<td style="text-align: center;">2756357</td>
<td style="text-align: center;">3065259</td>
<td style="text-align: center;">3706387</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>SDN</strong></td>
<td style="text-align: center;">1479650</td>
<td style="text-align: center;">1973025</td>
<td style="text-align: center;">2342339</td>
<td style="text-align: center;">2703061</td>
<td style="text-align: center;">4555435</td>
<td style="text-align: center;">3756475</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>SFN</strong></td>
<td style="text-align: center;">4377716</td>
<td style="text-align: center;">3920689</td>
<td style="text-align: center;">5006441</td>
<td style="text-align: center;">5839649</td>
<td style="text-align: center;">6100056</td>
<td style="text-align: center;">6890151</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>SLN</strong></td>
<td style="text-align: center;">3904947</td>
<td style="text-align: center;">3939317</td>
<td style="text-align: center;">3295004</td>
<td style="text-align: center;">4310464</td>
<td style="text-align: center;">4586212</td>
<td style="text-align: center;">4614629</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>WAS</strong></td>
<td style="text-align: center;">2201963</td>
<td style="text-align: center;">2695171</td>
<td style="text-align: center;">4548131</td>
<td style="text-align: center;">4399456</td>
<td style="text-align: center;">5365085</td>
<td style="text-align: center;">5448179</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Later on we will look at the benefits of “tidy data”, but the basic idea is that you can “facet” your analysis easily when your groups are represented as factors instead of arranged as a table. For example, here is a time series graph that is faceted by teams:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2000</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">"AL"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">Mean_Player_Salary=</span><span class="fu">mean</span>(salary) ) <span class="ot">-&gt;</span> t1</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>( <span class="at">data=</span>t1, <span class="at">x=</span>yearID, <span class="at">y=</span>Mean_Player_Salary, </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">geom=</span><span class="fu">c</span>(<span class="st">"point"</span>, <span class="st">"smooth"</span>)  ) <span class="sc">+</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_wrap</span>( <span class="sc">~</span> teamID, <span class="at">ncol=</span><span class="dv">5</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5_20-group-structure_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Now you can quickly see that Detroit is the team that has raised salaries most aggressively.</p>
<p>If we need to, we can easily convert a tidy dataset into something that looks like a table using the <strong>spread()</strong> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2006</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">"NL"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">mean =</span> <span class="fu">dollar</span>(<span class="fu">mean</span>(salary)) ) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">spread</span>( <span class="at">key=</span>yearID, <span class="at">value=</span>mean, <span class="at">sep=</span><span class="st">"_"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">select</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span> ) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>             pander</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">teamID</th>
<th style="text-align: center;">yearID_2007</th>
<th style="text-align: center;">yearID_2008</th>
<th style="text-align: center;">yearID_2009</th>
<th style="text-align: center;">yearID_2010</th>
<th style="text-align: center;">yearID_2011</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">ARI</td>
<td style="text-align: center;">$1,859,555</td>
<td style="text-align: center;">$2,364,383</td>
<td style="text-align: center;">$2,812,141</td>
<td style="text-align: center;">$2,335,314</td>
<td style="text-align: center;">$1,986,660</td>
</tr>
<tr class="even">
<td style="text-align: center;">ATL</td>
<td style="text-align: center;">$3,117,530</td>
<td style="text-align: center;">$3,412,189</td>
<td style="text-align: center;">$3,335,385</td>
<td style="text-align: center;">$3,126,802</td>
<td style="text-align: center;">$3,346,257</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CHN</td>
<td style="text-align: center;">$3,691,494</td>
<td style="text-align: center;">$4,383,179</td>
<td style="text-align: center;">$5,392,360</td>
<td style="text-align: center;">$5,429,963</td>
<td style="text-align: center;">$5,001,893</td>
</tr>
<tr class="even">
<td style="text-align: center;">CIN</td>
<td style="text-align: center;">$2,210,483</td>
<td style="text-align: center;">$2,647,061</td>
<td style="text-align: center;">$3,198,196</td>
<td style="text-align: center;">$2,760,059</td>
<td style="text-align: center;">$2,531,571</td>
</tr>
<tr class="odd">
<td style="text-align: center;">COL</td>
<td style="text-align: center;">$2,078,500</td>
<td style="text-align: center;">$2,640,596</td>
<td style="text-align: center;">$2,785,222</td>
<td style="text-align: center;">$2,904,379</td>
<td style="text-align: center;">$3,390,310</td>
</tr>
<tr class="even">
<td style="text-align: center;">FLO</td>
<td style="text-align: center;">$984,097</td>
<td style="text-align: center;">$660,955</td>
<td style="text-align: center;">$1,315,500</td>
<td style="text-align: center;">$2,112,212</td>
<td style="text-align: center;">$2,190,154</td>
</tr>
<tr class="odd">
<td style="text-align: center;">HOU</td>
<td style="text-align: center;">$3,250,333</td>
<td style="text-align: center;">$3,293,719</td>
<td style="text-align: center;">$3,814,682</td>
<td style="text-align: center;">$3,298,411</td>
<td style="text-align: center;">$2,437,724</td>
</tr>
<tr class="even">
<td style="text-align: center;">LAN</td>
<td style="text-align: center;">$3,739,811</td>
<td style="text-align: center;">$4,089,260</td>
<td style="text-align: center;">$4,016,584</td>
<td style="text-align: center;">$3,531,778</td>
<td style="text-align: center;">$3,472,967</td>
</tr>
<tr class="odd">
<td style="text-align: center;">MIL</td>
<td style="text-align: center;">$2,629,130</td>
<td style="text-align: center;">$2,790,948</td>
<td style="text-align: center;">$3,083,942</td>
<td style="text-align: center;">$2,796,837</td>
<td style="text-align: center;">$2,849,911</td>
</tr>
<tr class="even">
<td style="text-align: center;">NYN</td>
<td style="text-align: center;">$3,841,055</td>
<td style="text-align: center;">$4,593,113</td>
<td style="text-align: center;">$5,334,785</td>
<td style="text-align: center;">$4,800,819</td>
<td style="text-align: center;">$4,401,752</td>
</tr>
<tr class="odd">
<td style="text-align: center;">PHI</td>
<td style="text-align: center;">$2,980,940</td>
<td style="text-align: center;">$3,495,710</td>
<td style="text-align: center;">$4,185,335</td>
<td style="text-align: center;">$5,068,871</td>
<td style="text-align: center;">$5,765,879</td>
</tr>
<tr class="even">
<td style="text-align: center;">PIT</td>
<td style="text-align: center;">$1,427,327</td>
<td style="text-align: center;">$1,872,684</td>
<td style="text-align: center;">$1,872,808</td>
<td style="text-align: center;">$1,294,185</td>
<td style="text-align: center;">$1,553,345</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SDN</td>
<td style="text-align: center;">$2,235,022</td>
<td style="text-align: center;">$2,376,697</td>
<td style="text-align: center;">$1,604,952</td>
<td style="text-align: center;">$1,453,819</td>
<td style="text-align: center;">$1,479,650</td>
</tr>
<tr class="even">
<td style="text-align: center;">SFN</td>
<td style="text-align: center;">$3,469,964</td>
<td style="text-align: center;">$2,641,190</td>
<td style="text-align: center;">$2,965,230</td>
<td style="text-align: center;">$3,522,905</td>
<td style="text-align: center;">$4,377,716</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SLN</td>
<td style="text-align: center;">$3,224,529</td>
<td style="text-align: center;">$3,018,923</td>
<td style="text-align: center;">$3,278,830</td>
<td style="text-align: center;">$3,741,630</td>
<td style="text-align: center;">$3,904,947</td>
</tr>
<tr class="even">
<td style="text-align: center;">WAS</td>
<td style="text-align: center;">$1,319,554</td>
<td style="text-align: center;">$1,895,207</td>
<td style="text-align: center;">$2,140,286</td>
<td style="text-align: center;">$2,046,667</td>
<td style="text-align: center;">$2,201,963</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>Salaries <span class="sc">%&gt;%</span> <span class="fu">filter</span>( yearID <span class="sc">&gt;</span> <span class="dv">2006</span> <span class="sc">&amp;</span> lgID <span class="sc">==</span> <span class="st">"NL"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>( teamID, yearID ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarize</span>( <span class="at">mean =</span> <span class="fu">dollar</span>(<span class="fu">mean</span>(salary)) ) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">spread</span>( <span class="at">key=</span>teamID, <span class="at">value=</span>mean, <span class="at">sep=</span><span class="st">"_"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">select</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>             pander</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">yearID</th>
<th style="text-align: center;">teamID_ARI</th>
<th style="text-align: center;">teamID_ATL</th>
<th style="text-align: center;">teamID_CHN</th>
<th style="text-align: center;">teamID_CIN</th>
<th style="text-align: center;">teamID_COL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">2007</td>
<td style="text-align: center;">$1,859,555</td>
<td style="text-align: center;">$3,117,530</td>
<td style="text-align: center;">$3,691,494</td>
<td style="text-align: center;">$2,210,483</td>
<td style="text-align: center;">$2,078,500</td>
</tr>
<tr class="even">
<td style="text-align: center;">2008</td>
<td style="text-align: center;">$2,364,383</td>
<td style="text-align: center;">$3,412,189</td>
<td style="text-align: center;">$4,383,179</td>
<td style="text-align: center;">$2,647,061</td>
<td style="text-align: center;">$2,640,596</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2009</td>
<td style="text-align: center;">$2,812,141</td>
<td style="text-align: center;">$3,335,385</td>
<td style="text-align: center;">$5,392,360</td>
<td style="text-align: center;">$3,198,196</td>
<td style="text-align: center;">$2,785,222</td>
</tr>
<tr class="even">
<td style="text-align: center;">2010</td>
<td style="text-align: center;">$2,335,314</td>
<td style="text-align: center;">$3,126,802</td>
<td style="text-align: center;">$5,429,963</td>
<td style="text-align: center;">$2,760,059</td>
<td style="text-align: center;">$2,904,379</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2011</td>
<td style="text-align: center;">$1,986,660</td>
<td style="text-align: center;">$3,346,257</td>
<td style="text-align: center;">$5,001,893</td>
<td style="text-align: center;">$2,531,571</td>
<td style="text-align: center;">$3,390,310</td>
</tr>
<tr class="even">
<td style="text-align: center;">2012</td>
<td style="text-align: center;">$2,733,512</td>
<td style="text-align: center;">$2,856,205</td>
<td style="text-align: center;">$3,392,194</td>
<td style="text-align: center;">$2,935,843</td>
<td style="text-align: center;">$2,692,054</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2013</td>
<td style="text-align: center;">$3,004,400</td>
<td style="text-align: center;">$3,254,501</td>
<td style="text-align: center;">$3,867,989</td>
<td style="text-align: center;">$4,256,178</td>
<td style="text-align: center;">$2,976,363</td>
</tr>
<tr class="even">
<td style="text-align: center;">2014</td>
<td style="text-align: center;">$3,763,904</td>
<td style="text-align: center;">$4,067,042</td>
<td style="text-align: center;">$2,426,759</td>
<td style="text-align: center;">$3,864,911</td>
<td style="text-align: center;">$3,180,117</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2015</td>
<td style="text-align: center;">$2,132,207</td>
<td style="text-align: center;">$2,990,885</td>
<td style="text-align: center;">$4,138,547</td>
<td style="text-align: center;">$4,187,862</td>
<td style="text-align: center;">$3,827,544</td>
</tr>
<tr class="even">
<td style="text-align: center;">2016</td>
<td style="text-align: center;">$3,363,041</td>
<td style="text-align: center;">$2,362,010</td>
<td style="text-align: center;">$5,312,678</td>
<td style="text-align: center;">$3,066,899</td>
<td style="text-align: center;">$3,413,487</td>
</tr>
</tbody>
</table>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./5_10-constructing-groups.html" class="pagination-link" aria-label="Constructing Groups">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Constructing Groups</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./6_10-intro-to-data-viz.html" class="pagination-link" aria-label="Intro to Data Viz">
        <span class="nav-page-text">Intro to Data Viz</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>